#!/bin/bash

#
# Configured script to set Ethernet and WiFi configuration
#
REV=20190221

TACFILE="/etc/portex/tac_server.conf"

prompt="Select function options: "
options=("Configure TACACS+ server1" \
	"Configure TACACS+ server2" \
	"Ping TACACS+ server" \
	"Test TACACS+ configuration" \
	)

echo ""
echo ""
PS3="$prompt "
select opt in "${options[@]}" "Quit"; do 

case "$REPLY" in

1) echo "Configure TACACS+ server1: "
	echo ""
	TAC_SERVER1=`cat $TACFILE | egrep -v '#' | egrep SERVER1 | awk -F= '{print $2}'`
	TAC_KEY1=`cat $TACFILE | egrep -v '#' | egrep KEY1 | awk -F= '{print $2}'`
	echo -e "Current TACACS+ server1 IP address: $TAC_SERVER1"
	echo -e "Current TACACS+ server1 tacacs key: $TAC_KEY1\n"
	echo ""
	read -p "Are you sure to change the TACACS+ information? (Y/N): " ANSWER
	case $ANSWER in
		Y) echo "Change TACACS+ server1 configuration: "
			echo ""
			read -p "New TACACS+ server1 IP address: " ANSWER_IP
			read -p "New TACACS+ server1 tacacs key: " ANSWER_KEY
			echo "$ANSWER_IP:$ANSWER_KEY"
			echo ""
			;;
		*) echo "TACACS+ server1 configuration unchanged."
			echo ""
			;;
	esac

	;;

2) echo "Configure TACACS+ configutation: "
	echo ""
	read -p "New TACACS+ server address: " TACSERVER
	read -p "New TACACS+ key: " TACKEY
	sed -i 's/^SERVER=.*$/SERVER='"$TACSERVER"'/' $TACFILE
	sed -i 's/^KEY=.*$/KEY='"$TACKEY"'/' $TACFILE
	echo ""
	echo "New TACACS+ server: $TACSERVER"
	echo -e "New TACACS+ key: $TACKEY"
	echo ""
	;;

3) echo "Ping TACACS+ server: "
	echo ""
	ping -c 5 $TACSERVER
	echo ""
	;;

4) echo "Test TACACS+ configuration"
	echo ""
	TAC_CLIENT="/usr/local/bin/tacacs_client"
	read -p "TACACS+ username: " TACUSERNAME
	read -sp "TACACS+ password: " TACPASSWORD
	echo ""
	$TAC_CLIENT -u $TACUSERNAME -H $TACSERVER -k $TACKEY -v authenticate --password $TACPASSWORD 2>/dev/null
	echo ""
	;;

$(( ${#options[@]}+1 )) ) echo "Goodbye!"; break;;

*) echo "Invalid option. Try another one.";continue;;

esac

done

